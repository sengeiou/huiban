<!DOCTYPE html>
<!--关注-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>关注</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index.css">
</head>
<script src="./js/rem.js"></script>
<script src="./js/jquery.min.js"></script>
<body>
    <div class="wrap follow">
        <header>
            <span>
                <a href="./finish_page.html"></a>
            </span>
            <span>
                <input id="textMsg" type="text">
                <i class="search"><img src="./images/reset/ic_search.png" alt=""></i>
            </span>
        </header>
        <main>

        </main>
    </div>
</body>
<script>
   function getContent (data) {
        var data = JSON.parse(data);   
        for (var i=0; i<data.length; i++) {
            var nowMsg = $('main').html();
            if(data[i].subjectName == undefined ){
                data[i].subjectName = '';
            }
            $('main').html(nowMsg + `
                <div class="content">
                    <dl>
                        <dt><img src="${data[i].ico}" onerror="this.src='./images/reset/default_head.png'"/></dt>
                        <dd>
                            <p>${data[i].name}</p>
                            <p>${data[i].subjectName}</p>
                        </dd>
                    </dl>
                    <div class="right">
                        <aside class="leaveBox">
                            <img src="./images/reset/ic_message.png">
                            <i class="lMsg">留言</i>
                        </aside>
                        <aside class="flag ttention"></aside>
                    </div>
                </div>
            `);
            if (data[i].isAttention == 1) {
                $('.flag').eq(i).html(`
                    <img class="addImg" src="./images/reset/ic_has_concerned.png">
                    <span class="removeFollow remove">取消关注</span>
                `);                
            }else {
                $('.flag').eq(i).html(`
                    <img class="removeImg" src="./images/classMsg/add_attention@2x.png" style="width: 0.6rem;">                         
                    <span class="removeFollow add">加关注</span>
                `);   
            }
        }
        
        //取消关注
        $('.flag').bind('click', function () {
            if ($(this).children('span').text() == "取消关注") {
                var ind = $(this).parents('.content').index();
                var attUserId = data[ind].attUserId;
                //var msg = JSON.stringify({"attUserId": attUserId});
                console.log("取消关注"+attUserId);
                window.android.dealWithAttention(false,attUserId,ind);
            }else {
                var ind = $(this).parents('.content').index();
                var attUserId = data[ind].attUserId;
                //var msg = JSON.stringify({"attUserId": attUserId});
                console.log("加关注"+attUserId);
                window.android.dealWithAttention(true,attUserId,ind);
            }
        });
        //点击跳转到去留言
        $('.leaveBox').bind('click', function () {
            var ind = $(this).parents('.content').index();
            var name = data[ind].name;
            var userId = data[ind].attUserId;
            console.log('去留言'+name+", "+userId);
            window.android.goLiuYan(name,userId);
        });
    }
    //点击查找
    $('.search').bind('click', function () {
        var msg = $('#textMsg').val();
        if(msg.length>0){
            window.android.search(msg);
        }
    })
    function addType (i) {
$('.flag').eq(i).html(`
<img class="removeImg" src="./images/classMsg/add_attention@2x.png" style="width: 0.6rem;">
<span class="removeFollow add">加关注</span>
`);
}
function removeType (i) {
$('.flag').eq(i).html(`
<img class="addImg" src="./images/reset/ic_has_concerned.png">
<span class="removeFollow remove">取消关注</span>
`);
}
</script>
</html>