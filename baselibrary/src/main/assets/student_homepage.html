<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>慧班</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index1.css">
    <link rel="stylesheet" href="./css/index2.css">
</head>
<script src="./js/rem.js"></script>
<script type="text/javascript" src="./js/jquery.min.js"></script>


<body>
    <div class="wrap indexWrap">
        <main>
            <div class="topBox">
                <div class="head">
                    <span class="userImg"></span>
                    <p class="nowTime">
                        <span class="nowDate"></span>
                        <span class="week"></span>
                    </p>
                </div>
                <div class="tab">
                    <div class="content">
                        <span>上午没有课哦</span>
                    </div>
                    <div class="content">
                        <span>语文 | 5</span>
                        <span>数学 | 6</span>
                    </div>
                    <div class="content">
                        <span>语文 | 9</span>
                    </div>
                    <div class="weather">
                        <span class="weatherImg selected morning"></span>
                        <span class="weatherImg unChecked afternoon"></span>
                        <span class="weatherImg unChecked evening"></span>
                    </div>
                </div>
                <div class="tabList">
                    <a href="./html/class/class.html">
                        <span class="listImg class"></span>
                        <span>
                            班级
                        </span>
                    </a>
                    <a href="./html/class/classTab.html">
                        <span class="listImg timeTable"></span>
                        <span>
                            课表
                        </span>
                    </a>
                    <a href="./html/class/notic.html">
                        <span class="listImg notice"></span>
                        <span>
                            通知
                        </span>
                    </a>
                    <a href="./html/leaveMsg/goMsg.html">
                        <span class="listImg follow"></span>
                        <span>
                            关注
                        </span>
                    </a>
                </div>
            </div>
            <!-- 慧辅导 -->
            <div class="coach">
                <h3 class="title">慧辅导</h3>
                <div class="list">
                    <div class="course">
                        <img src="./images/mipmap2/class_overview_pic.png" alt="">
                    </div>
                    <div class="course">
                        <img src="./images/mipmap2/class_overview_pic.png" alt="">
                    </div>
                </div>
                <p class="lookAll">
                    <a href="./html/coach/coach.html">查看全部</a>
                </p>
                <h3 class="resources">
                    <a href="./html/class/course.html">
                        学习资源
                        <p>老师推荐精品课程，快去看看吧！</p>
                        <img src="./images/mipmap2/arrow_right.png">
                    </a>
                </h3>
            </div>
            <!-- 去留言 -->
            <div class="leave">
                <h3>
                    <span>最新留言</span>
                    <span>
                        <a href="./html/leaveMsg/leave.html">
                            去留言
                            <img src="./images/mipmap2/arrow_right.png">
                        </a>
                    </span>
                </h3>
                <div class="box">
                    <div class="leaveWord">
                        <div class="left">
                            <dl>
                                <dt>
                                    <img src="./images/mipmap2/ic_home_class.png" alt="">
                                </dt>
                                <dd>
                                    <p class="name">杜鹃
                                        <span> 五年级二班</span>
                                    </p>
                                    <p class="time">10月20日 20:30</p>
                                    <p class="content">看会小说风科技文化发空间划分空间大会上的感觉萨国际化发生科技大空间</p>
                                    <p class="button">
                                        <span class="reply">回复</span>
                                        <span class="dele">删除</span>
                                    </p>
                                </dd>
                            </dl>
                        </div>
                    </div>
                    <div class="leaveWord">
                        <div class="left">
                            <dl>
                                <dt>
                                    <img src="./images/mipmap2/ic_home_class.png" alt="">
                                </dt>
                                <dd>
                                    <p class="name">杜鹃
                                        <span> 五年级二班</span>
                                    </p>
                                    <p class="time">10月20日 20:30</p>
                                    <p class="content">看会小说风科技文化发空间划分空间大会上的感觉萨国际化发生科技大空间快点结婚时刻记得哈市科就会看见</p>
                                    <p class="button">
                                        <span>回复</span>
                                        <span>删除</span>
                                    </p>
                                </dd>
                            </dl>
                        </div>
                    </div>
                    <div class="leaveWord">
                        <div class="left">
                            <dl>
                                <dt>
                                    <img src="./images/mipmap2/ic_home_class.png" alt="">
                                </dt>
                                <dd>
                                    <p class="name">杜鹃
                                        <span> 五年级二班</span>
                                    </p>
                                    <p class="time">10月20日 20:30</p>
                                    <p class="content">看会小说风科技文化发空间划分空间大会上的感觉萨国际化发生科技大空间快点结婚时刻记得哈市科就会看见</p>
                                    <p class="button">
                                        <span>回复</span>
                                        <span>删除</span>
                                    </p>
                                </dd>
                            </dl>
                        </div>

                    </div>
                </div>
                <h2 class="more">查看全部</h2>
                <div id="reply">
                    <div id="boxx">
                        <h3 class="comment">
                            <i>X</i>评论
                            <span class="num"> 5</span>
                        </h3>
                        <div class="huifu">
                            <ul>
                                <li>
                                    <span class="img"></span>张同学</li>
                                <li>每天的撒打算大咖技术谁看见爱的三带我打撒所大所大多</li>
                                <li>
                                    <span class="img1"></span>
                                    <span>10</span>
                                    <span class="img2"></span>
                                    <span>100</span>
                                </li>
                            </ul>
                            <ul>
                                <li>
                                    <span class="img"></span>张同学</li>
                                <li>每天的撒打算大咖技术谁看见爱的三带我打撒所大所大多</li>
                                <li>
                                    <span class="img1"></span>
                                    <span>10</span>
                                    <span class="img2"></span>
                                    <span>100</span>
                                </li>
                            </ul>
                            <ul>
                                <li>
                                    <span class="img"></span>张同学</li>
                                <li>每天的撒打算大咖技术谁看见爱的三带我打撒所大所大多</li>
                                <li>
                                    <span class="img1"></span>
                                    <span>10</span>
                                    <span class="img2"></span>
                                    <span>100</span>
                                </li>
                            </ul>
                            <ul>
                                <li>
                                    <span class="img"></span>张同学</li>
                                <li>每天的撒打算大咖技术谁看见爱的三带我打撒所大所大多</li>
                                <li>
                                    <span class="img1"></span>
                                    <span>10</span>
                                    <span class="img2"></span>
                                    <span>100</span>
                                </li>
                            </ul>

                            <ul>
                                <li>
                                    <span class="img"></span>张同学</li>
                                <li>每天的撒打算大咖技术谁看见爱的三带我打撒所大所大多</li>
                                <li>
                                    <span class="img1"></span>
                                    <span>10</span>
                                    <span class="img2"></span>
                                    <span>100</span>
                                </li>
                            </ul>
                            <ul>
                                <li>
                                    <span class="img"></span>张同学</li>
                                <li>每天的撒打算大咖技术谁看见爱的三带我打撒所大所大多</li>

                                <li>
                                    <span class="img1"></span>
                                    <span>10</span>
                                    <span class="img2"></span>
                                    <span>100</span>
                                </li>
                            </ul>
                        </div>

                        <!-- <h3 class="mores">点击加载更多</h3> -->
                    </div>
                    <div class="foot">
                        <textarea placeholder="此处填写评论...."></textarea>
                        <button type="submit">发表</button>

                    </div>
                </div>

        </main>
        <footer>
            <a href="./index.html">
                <span class="footImg pageIndex"></span>
                <span>首页</span>
            </a>
            <a href="./html/work/work.html">
                <span class="footImg pageWork"></span>
                <span>作业</span>
            </a>
            <a href="./html/report/report.html">
                <span class="footImg pageReport"></span>
                <span>报告</span>
            </a>
            <a href="./html/wrong/wrong.html">
                <span class="footImg pageWrong"></span>
                <span>错题</span>
            </a>
        </footer>
        <!-- 侧边栏 -->
        <div class="leftMenu">
            <div class="menuContent">
                <div class="menuTop">
                    <dl>
                        <dt class="userImg"></dt>
                        <dd>
                            <h3 class="userName">杜鹃</h3>
                            <p class="className">嵩县思源测试智慧班级</p>
                        </dd>
                    </dl>
                </div>
                <div class="menuList">
                    <a href="./html/leftMenu/myFavorite.html">
                        <span class="navImg">
                        </span>
                        <span>我的收藏</span>
                    </a>
                    <a href="./html/leftMenu/mySpace.html">
                        <span class="navImg">
                        </span>
                        <span>我的空间</span>
                    </a>
                    <a href="./html/leftMenu/aboutH.html">
                        <span class="navImg">
                        </span>
                        <span>关于慧班</span>
                    </a>
                    <a href="./html/leftMenu/feedback.html">
                        <span class="navImg">
                        </span>
                        <span>意见反馈</span>
                    </a>
                    <a href="./html/leftMenu/clearCache.html">
                        <span class="navImg">
                        </span>
                        <span>清除缓存</span>
                    </a>
                </div>
                <div class="close">
                    退出登录
                </div>
            </div>
            <div class="right">

            </div>
        </div>
        </div>
</body>

<script type="text/javascript" >
    let leftMenu = $('.leftMenu'),
        nowTime = $('.nowDate'),
        nowWeek = $('.week'),
        weather = $('.weatherImg'),
        curriculum = $('.tab>.content');
    //侧边栏显示隐藏
    $('.right').bind('click', function () {
        leftMenu.css('display', 'none');
    })
    $('.userImg').bind('click', function () {
        leftMenu.css('display', 'block');
    });

    //获取时间
    function getNowTime() {
        function p(s) {
            return s < 10 ? '0' + s : s;
        }
        //首页年月日
        var myDate = new Date();
        //获取当前年
        var year = myDate.getFullYear();
        //获取当前月
        var month = myDate.getMonth() + 1;
        //获取当前日
        var date = myDate.getDate();
        //获取当前星期
        var nowDate = p(month) + "/" + p(date) + "/" + year;
        var day = new Date(Date.parse(nowDate));
        var today = new Array('星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六');
        var week = today[day.getDay()];
        //当前年月日
        var now = year + '年' + p(month) + "月" + p(date) + "日";
        nowTime.html(now);
        nowWeek.html(week);
    }
    getNowTime();
    var list = JSON.parse('[{"id":3004049,"classId":3000153,"semesterId":3000120,"week":2,"num":1,"subjectId":2,"teacherId":2030213,"beginTime":"08:20:00","endTime":"09:00:00","subjectName":"\u6570\u5b66","teacherName":"\u6768\u6cfd\u6668"},{"id":3004056,"classId":3000153,"semesterId":3000120,"week":2,"num":2,"subjectId":4,"teacherId":2030219,"beginTime":"09:10:00","endTime":"09:50:00","subjectName":"\u7269\u7406","teacherName":"\u694a\u694a"},{"id":3004063,"classId":3000153,"semesterId":3000120,"week":2,"num":3,"subjectId":1,"teacherId":2029920,"beginTime":"10:20:00","endTime":"10:55:00","subjectName":"\u8bed\u6587","teacherName":"\u8d75\u5efa\u5ddd"},{"id":3004077,"classId":3000153,"semesterId":3000120,"week":2,"num":5,"subjectId":3,"teacherId":2030216,"beginTime":"14:30:00","endTime":"15:10:00","subjectName":"\u82f1\u8bed","teacherName":"\u6c88\u9633Y"},{"id":3004084,"classId":3000153,"semesterId":3000120,"week":2,"num":6,"subjectId":0,"teacherId":0,"beginTime":"15:20:00","endTime":"16:00:00","subjectName":"","teacherName":""},{"id":3004091,"classId":3000153,"semesterId":3000120,"week":2,"num":7,"subjectId":4,"teacherId":2030219,"beginTime":"16:25:00","endTime":"17:05:00","subjectName":"\u7269\u7406","teacherName":"\u694a\u694a"},{"id":3004098,"classId":3000153,"semesterId":3000120,"week":2,"num":8,"subjectId":0,"teacherId":0,"beginTime":"17:15:00","endTime":"17:45:00","subjectName":"","teacherName":""},{"id":3004105,"classId":3000153,"semesterId":3000120,"week":2,"num":9,"subjectId":0,"teacherId":0,"beginTime":"18:50:00","endTime":"19:30:00","subjectName":"","teacherName":""},{"id":3004112,"classId":3000153,"semesterId":3000120,"week":2,"num":10,"subjectId":0,"teacherId":0,"beginTime":"19:40:00","endTime":"20:20:00","subjectName":"","teacherName":""},{"id":0,"classId":0,"week":"2","num":4,"subjectName":"","teacherName":""}]')

    //切换课表
    function switchs(data) {
        var tab = document.getElementsByClassName("tab")[0];
        var str1 = "";
        var str2 = "";
        var str3 = "";
        var res1 = [];
        var res2 = [];
        var res3 = [];
        for (var pro of data) {
            if (pro.num <= 4) {
                res1.push(pro)
            } else if (pro.num <= 8) {
                res2.push(pro)
            } else {
                res3.push(pro)
            }
        }
        for (pro of res1) {
            if (pro.subjectName == "") {
                pro.subjectName = "无课";
            }
            str1 += `<span>${pro.subjectName} ${pro.num}</span>`;
        }
        curriculum[0].innerHTML = str1;
        for (pro of res2) {
            if (pro.subjectName == "") {
                pro.subjectName = "无课";
            }
            str2 += `<span>${pro.subjectName} ${pro.num}</span>`;
        }
        curriculum[1].innerHTML = str2;
        for (pro of res3) {
            if (pro.subjectName == "") {
                pro.subjectName = "无课";
            }
            str3 += `<span>${pro.subjectName} ${pro.num}</span>`;
        }
        curriculum[2].innerHTML = str3;
    }
    switchs(list)

    // 课表切换功能
    curriculum.hide();
    curriculum.eq(0).show();
    weather.bind('click', function () {
        console.log($(this))
        let ind = $(this).index();
        console.log(ind)
        $(this).parent().siblings().eq(ind).show().siblings().hide();
        $(this).parent().show();
    })

    // 慧辅导导航
    function imag(data) {
        var str = "";
        var list = document.getElementsByClassName("list")[0];
        str += `
            <div class="course">
                        <img src=${data[0].imgUrl} onerror="this.src='./images/mipmap2/ic_home_class.png'"alt="">
                    </div>
                    <div class="course">
                        <img src=${data[1].imgUrl} onerror="this.src='./images/mipmap2/ic_home_class.png'"alt="">
                    </div>
            `;
        list.innerHTML = str;
    }
    var array;
    // 留言页 回复页
    function message(data) {
        var attr = "";
        var attr2 = "";
        // var attr;
        array = data;
        for (var pro of data) {
            console.log(pro.imgUrl)
            if(pro.imgUrl == "") {
                pro.imgUrl = "./images/mipmap2/ic_home_class.png";
            }
            attr += `
            <div class="leaveWord">
                        <div class="left">
                            <dl>
                                <dt>
                                    <img class="err" src=${pro.imgUrl} onerror="this.src='./images/mipmap2/ic_home_class.png'"alt="">
                                </dt>
                                <dd>
                                    <p class="name">${pro.sendName}
                                        <span> 五年级二班</span></p>
                                    <p class="time">${pro.addTime}</p>
                                    <p class="content">${pro.content}</p>
                                    <p class="button">
                                        <span class="rep">回复</span>
                                        <span class="dele">删除</span>
                                    </p>
                                </dd>
                            </dl>
                        </div>
                       </div> 
            `;
        }
        var xbox = document.getElementsByClassName("box")[0];
        xbox.innerHTML = attr;
        var dele = document.getElementsByClassName("dele");
        var rep = document.getElementsByClassName("rep");
        var boxx = document.getElementById("boxx");
        var div = document.getElementById("reply");
        var text = document.getElementsByTagName("textarea")[0];
        var button = document.getElementsByTagName("button")[0];
        var close = document.getElementsByTagName("i")[0];
        var mores = document.getElementsByClassName("more")[0];
        var huifu = document.getElementsByClassName("huifu")[0];
        var num = document.getElementsByClassName("num")[0];
        var index;
      
        // 点击加载更多
        mores.onclick = function () {
            var key1 = 'getUserLeaveList';
            var param = '{"userId":"2030246","start":"0","limit":"10"}'
            $.get('http://192.168.0.244:8080/closeBroadcast?key=' + key1 + '&param=' + param, function (data) {
                messages = JSON.parse(data).data
                console.log(messages);
                message(messages)
            });
        }
        // 点击回复
        for (let i = 0; i < rep.length; i++) {
            var conten1 = "";
            var conten2 = "";
            rep[i].onclick = function () {
                index = i;
                console.log("回复")
                var time = setInterval(fn, 10);
                function fn() {
                    var sty = div.currentStyle || getComputedStyle(div, null);
                    var bottom = parseInt(sty.bottom);
                    bottom = bottom + 12.5;
                    div.style.bottom = bottom + 'px';
                    if (bottom >-1) {
                        clearInterval(time)
                    }
                }
                if (data[i].slist) {
                    for (var pro of data[i].slist) {
                        console.log(pro)
                        
                        conten1 += `
                    <ul>
                        <li><span class="img"></span>${pro.sendName}</li>
                        <li>${pro.content}</li>
                        <li>${pro.addTime}</li>
                        <li><span class="dele2">删除</span></li>
                    </ul>
                `;
                    }
                    num.innerHTML = data[i].slist.length;
                    huifu.innerHTML = conten1;
                    conten1="";
                } else {
                    conten2="";
                    conten2 += `
                    <ul>
                        <li class="empt">回复内容为空</li>
                    </ul>
                `;
                num.innerHTML = 0;
                huifu.innerHTML = conten2;
                
                }
               
                // 删除回复留言
                var dele2 = document.getElementsByClassName("dele2");
                for (let j = 0; j < dele2.length; j++) {
                    dele2[j].onclick = function () {
                        console.log(data[i].slist[j].id)
                        var msg = data[i].slist[j].id;
                        // window.android.delete(msg, null) 

                    }
                }
            }
        }
        close.onclick = function () {
            div.style.bottom = "-12rem"
        }
        // 删除留言
        for (let i = 0; i < dele.length; i++) {
            dele[i].onclick = function () {
                console.log("删除");
                var msgid = data[i].id;
                console.log(msgid)
                window.android.deleteMessageItem(msgid, null)

            }
        }
        // 留言回复
        button.onclick = function () {
            if (text.value != "") {
                var content = text.value;
                console.log(data[index].send)
                // 收信人id
                var rece = data[index].send;
                console.log(text.value);
                // var key3 = 'addLeaveMessage';
                // var param = JSON.stringify({"recevieId":,"sendId":,"content":content})
                // console.log(param)
                // $.get('http://192.168.0.244:8080/closeBroadcast?key=' + key3 + '&param=' + param, function (data) {
                //     imgs = JSON.parse(data).data
                //     console.log(imgs);
                //     imag(imgs)
                // });
                text.value = "";
            }
        }
    }
    var messages;
    var imgs;
    // var messages =JSON.parse('[{"id":"5ad6df4bf5ddaf069d970f98","imgUrl":"","send":"2030076","sendRoleId":1,"sendName":"\u6c88\u967d","content":"ooo ","addTime":"2018-04-18 14:01","count":0},{"id":"5ad41d45f5ddaf069d970eab","imgUrl":"","send":"2030389","sendRoleId":1,"sendName":"\u675c\u5a1f","content":"hjh","addTime":"2018-04-16 11:49","count":0},{"id":"5acf25faf5ddaf069d970e45","imgUrl":"","send":"2030246","sendRoleId":1,"sendName":"\u6234\u5e05\u5e05","content":"\u7c7b\u4e2b\u7684\u786e\u5b9e","addTime":"2018-04-12 17:25","count":0},{"id":"5ac46449f5ddaf069d970e07","imgUrl":"","send":"2030246","sendRoleId":1,"sendName":"\u6234\u5e05\u5e05","content":"\u6d4b\u8bd52","addTime":"2018-04-04 13:36","count":0},{"id":"5ac46416f5ddaf069d970e03","imgUrl":"","send":"2030246","sendRoleId":1,"sendName":"\u6234\u5e05\u5e05","content":"\u6d4b\u8bd5","addTime":"2018-04-04 13:35","count":0}]');


    var key1 = 'getUserLeaveList';
    var param = '{"userId":"2030246","start":"0","limit":"3"}'
    $.get('http://192.168.0.244:8080/closeBroadcast?key=' + key1 + '&param=' + param, function (data) {
        messages = JSON.parse(data).data
        console.log(messages);
        //message(messages)
    });
    var key2 = 'getTeacherCourseList';
    var param = '{"userId":"2030219","start":"0","limit":"3"}'
    $.get('http://192.168.0.244:8080/closeBroadcast?key=' + key2 + '&param=' + param, function (data) {
        imgs = JSON.parse(data).data
        console.log(imgs);
        //imag(imgs)
    });


</script>
<!-- <script src="./js/index.js"></script> -->

</html>