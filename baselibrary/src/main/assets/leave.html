<!DOCTYPE html>
<!--去留言-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>去留言</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index.css">
</head>
<script src="./js/rem.js"></script>
<script src="./js/jquery.min.js"></script>
<body>
    <div class="wrap leave">
        <header>
            <span>
                <a href="/finish_page.html"></a>
            </span>	
            <span></span>
        </header>
        <main>
            <div class="content">
                <textarea name="" id="inputMsg" cols="30" rows="10"></textarea>
                <div class="note">
                    留言......
                </div>
            </div>
            <button class="inputMsg">发布</button>
            <div class="list"></div>
            <div class="replyBox">
                <p class="close">X</p>
            </div>
        </main>
    </div>
</body>
<script>
    var name = window.android.getName();
    var isSelf = window.android.isSelf();
    var userId = window.android.getUserId();
    console.log(isSelf);
    var recevieId = window.android.getRecevieId();
    console.log(recevieId);
    $('header span').eq(1).html(name);
    $('#inputMsg').bind('focus', function () {
        $('.note').hide();
    });
    //渲染列表
    function getContent (data) {
        var data = JSON.parse(data);
        $('.list').html('');
        $('textarea').val('');
        var aaa = '';
        for (var i=0; i<data.length; i++) {
            var nowMsg = $('.list').html();
            if(isSelf || ((data[i].send).toString()==userId)){
                aaa='<span class="remove">删除</span>';
            }
            $('.list').html(nowMsg + `
                <dl>
                    <dt><img src="${data[i].imgUrl}" alt="" onerror="this.src='./images/reset/default_head.png' "/></dt>
                    <dd>
                        <h3>${data[i].sendName}</h3>
                        <p class="message">${data[i].content}</p>
                        <p>${data[i].addTime}<span class="reply">回复</span>${aaa}</p>
                    </dd>
                </dl>
            `);    
        }
        //点击删除
        $('.remove').bind('click', function () {
            var ind = $(this).parents('dl').index();
            var msgid = data[ind].id;
            window.android.deleteMessageItem(msgid, null)
        });
        //点击回复弹出
        $('.reply').bind('click', function () {
            var ind = $(this).parents('dl').index();
            window.android.reply(ind);
        });
    };

    //点击发布
    $('.inputMsg').bind('click', function () {
        var msg = $('#inputMsg').val();
        var data = "null";
        if (msg == '') {

        }else {
            data = JSON.stringify({"recevieId":recevieId, "content":msg});
            window.android.replayMessage(data);
        }
    });
</script>
</html>